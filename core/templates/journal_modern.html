{% extends "base_modern.html" %}

{% block title %}Trading Journal - BFI Signals AI{% endblock %}

{% block page_title %}Trading Journal{% endblock %}

{% block extra_css %}
<style>
    /* Trading Journal Specific Styles */
    .journal-container {
        max-width: 1400px;
        margin: 0 auto;
    }

    .journal-header {
        text-align: center;
        margin-bottom: 40px;
        padding: 40px 20px;
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--golden-accent);
        border-radius: var(--border-radius-lg);
        position: relative;
        overflow: hidden;
    }

    .journal-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--golden-primary), var(--golden-bright));
    }

    .journal-header h1 {
        font-size: 32px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
    }

    .journal-header p {
        font-size: 16px;
        color: var(--text-secondary);
        margin: 0;
        font-style: italic;
    }

    /* Journal Stats Row */
    .journal-stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 32px;
    }

    .journal-stat-card {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--golden-accent);
        border-radius: var(--border-radius);
        padding: 24px;
        box-shadow: var(--box-shadow);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        text-align: center;
    }

    .journal-stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--golden-primary), var(--golden-bright));
    }

    .journal-stat-card:hover {
        border-color: var(--golden-secondary);
        transform: translateY(-2px);
        box-shadow: var(--golden-glow);
    }

    .journal-stat-card h3 {
        font-size: 14px;
        color: var(--text-secondary);
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 500;
    }

    .big-number {
        display: block;
        font-size: 36px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 8px;
        font-variant-numeric: tabular-nums;
    }

    .big-number.success {
        color: var(--success-color);
    }

    .big-number.profit {
        color: var(--profit-color);
    }

    .big-number.warning {
        color: var(--warning-color);
    }

    .stat-subtitle {
        font-size: 12px;
        color: var(--text-muted);
        margin: 0;
    }

    /* Signals Table Container */
    .signals-table-container {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--golden-accent);
        border-radius: var(--border-radius-lg);
        overflow: hidden;
        box-shadow: var(--box-shadow);
        margin-bottom: 32px;
    }

    /* Table Header */
    .table-header {
        padding: 24px 32px;
        background: rgba(212, 175, 55, 0.05);
        border-bottom: 1px solid var(--golden-accent);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }

    .table-title {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .table-title h2 {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
    }

    .table-title .icon {
        font-size: 24px;
    }

    .table-actions {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .filter-btn,
    .export-btn {
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--golden-accent);
        border-radius: 6px;
        color: var(--text-primary);
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .filter-btn:hover,
    .export-btn:hover {
        background: var(--golden-accent);
        border-color: var(--golden-secondary);
    }

    /* Enhanced Table */
    .journal-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    .journal-table th {
        background: rgba(255, 255, 255, 0.02);
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 12px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border-bottom: 1px solid var(--golden-accent);
        white-space: nowrap;
        position: sticky;
        top: 0;
        z-index: 10;
    }

    .journal-table td {
        padding: 16px 20px;
        color: var(--text-primary);
        font-weight: 500;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        font-variant-numeric: tabular-nums;
        vertical-align: middle;
    }

    .journal-table tbody tr {
        transition: all 0.2s ease;
    }

    .journal-table tbody tr:hover {
        background: rgba(212, 175, 55, 0.03);
    }

    /* Table Cell Styles */
    .symbol-cell {
        font-weight: 700;
        color: var(--golden-primary);
    }

    .signal-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-block;
    }

    .signal-badge.buy {
        background: rgba(0, 255, 136, 0.1);
        color: var(--success-color);
        border: 1px solid rgba(0, 255, 136, 0.2);
    }

    .signal-badge.sell {
        background: rgba(255, 71, 87, 0.1);
        color: var(--danger-color);
        border: 1px solid rgba(255, 71, 87, 0.2);
    }

    .outcome-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-block;
    }

    .outcome-badge.win {
        background: rgba(0, 255, 136, 0.1);
        color: var(--success-color);
        border: 1px solid rgba(0, 255, 136, 0.2);
    }

    .outcome-badge.loss {
        background: rgba(255, 71, 87, 0.1);
        color: var(--danger-color);
        border: 1px solid rgba(255, 71, 87, 0.2);
    }

    .outcome-badge.breakeven {
        background: rgba(255, 165, 2, 0.1);
        color: var(--warning-color);
        border: 1px solid rgba(255, 165, 2, 0.2);
    }

    .outcome-badge.pending {
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-muted);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .risk-badge {
        padding: 3px 8px;
        border-radius: 8px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .risk-badge.low {
        background: rgba(0, 255, 136, 0.1);
        color: var(--success-color);
    }

    .risk-badge.medium {
        background: rgba(255, 165, 2, 0.1);
        color: var(--warning-color);
    }

    .risk-badge.high {
        background: rgba(255, 71, 87, 0.1);
        color: var(--danger-color);
    }

    .profit-cell {
        font-weight: 700;
    }

    .profit-cell.positive {
        color: var(--profit-color);
    }

    .profit-cell.negative {
        color: var(--danger-color);
    }

    .profit-cell.neutral {
        color: var(--text-muted);
    }

    .probability-cell {
        font-weight: 600;
        color: var(--golden-primary);
    }

    .timestamp-cell {
        font-size: 12px;
        color: var(--text-muted);
    }

    /* Action Buttons */
    .action-btn {
        padding: 4px 8px;
        background: transparent;
        border: 1px solid var(--golden-accent);
        border-radius: 4px;
        color: var(--text-secondary);
        font-size: 11px;
        cursor: pointer;
        transition: all 0.2s ease;
        margin-right: 4px;
    }

    .action-btn:hover {
        background: var(--golden-accent);
        color: var(--text-primary);
    }

    .action-btn.primary {
        background: var(--golden-primary);
        color: var(--primary-bg);
        border-color: var(--golden-bright);
    }

    .action-btn.primary:hover {
        background: var(--golden-bright);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: var(--text-muted);
    }

    .empty-state .icon {
        font-size: 64px;
        margin-bottom: 16px;
        display: block;
        opacity: 0.5;
    }

    .empty-state h3 {
        font-size: 20px;
        margin-bottom: 8px;
        color: var(--text-secondary);
    }

    .empty-state p {
        font-size: 14px;
        margin-bottom: 24px;
    }

    /* Pagination */
    .pagination-container {
        padding: 20px 32px;
        background: rgba(255, 255, 255, 0.01);
        border-top: 1px solid var(--golden-accent);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 16px;
    }

    .pagination-info {
        font-size: 13px;
        color: var(--text-muted);
    }

    .pagination-controls {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .pagination-btn {
        padding: 6px 12px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--golden-accent);
        border-radius: 6px;
        color: var(--text-secondary);
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
    }

    .pagination-btn:hover:not(.disabled) {
        background: var(--golden-accent);
        color: var(--text-primary);
    }

    .pagination-btn.active {
        background: var(--golden-primary);
        color: var(--primary-bg);
        border-color: var(--golden-bright);
    }

    .pagination-btn.disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }

    /* Filters Panel */
    .filters-panel {
        background: var(--card-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--golden-accent);
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 20px;
        display: none;
    }

    .filters-panel.active {
        display: block;
        animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 16px;
    }

    .filter-group label {
        display: block;
        font-size: 12px;
        color: var(--text-secondary);
        margin-bottom: 6px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 500;
    }

    .filter-input,
    .filter-select {
        width: 100%;
        padding: 8px 12px;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--golden-accent);
        border-radius: 6px;
        color: var(--text-primary);
        font-size: 13px;
    }

    .filter-actions {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .journal-stats-row {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .table-header {
            flex-direction: column;
            align-items: stretch;
            gap: 16px;
        }
        
        .table-actions {
            justify-content: center;
        }
        
        .journal-table {
            font-size: 12px;
        }
        
        .journal-table th,
        .journal-table td {
            padding: 12px 16px;
        }
        
        .pagination-container {
            flex-direction: column;
            text-align: center;
        }
    }

    @media (max-width: 480px) {
        .journal-stats-row {
            grid-template-columns: 1fr;
        }
        
        .journal-header {
            padding: 24px 16px;
        }
        
        .journal-header h1 {
            font-size: 24px;
        }
        
        .big-number {
            font-size: 28px;
        }
        
        .table-header {
            padding: 16px 20px;
        }
        
        .pagination-container {
            padding: 16px 20px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="journal-container">
    <div class="journal-header">
        <h1>📝 Trading Journal</h1>
        <p>Track Hybrid Math Strategy Performance</p>
    </div>
    
    <!-- Journal Stats Row -->
    <div class="journal-stats-row">
        <div class="journal-stat-card">
            <h3>Total Signals</h3>
            <span class="big-number">{{ total_signals if total_signals else 0 }}</span>
            <p class="stat-subtitle">All time generated</p>
        </div>
        
        <div class="journal-stat-card">
            <h3>Win Rate</h3>
            <span class="big-number success">{{ "%.1f"|format(win_rate if win_rate else 0) }}%</span>
            <p class="stat-subtitle">Success ratio</p>
        </div>
        
        <div class="journal-stat-card">
            <h3>Avg R:R</h3>
            <span class="big-number warning">{{ "%.1f"|format(avg_rr if avg_rr else 0) }}</span>
            <p class="stat-subtitle">Risk-reward ratio</p>
        </div>
        
        <div class="journal-stat-card">
            <h3>Total P&L</h3>
            <span class="big-number profit">{{ "+$%.2f"|format(total_pnl if total_pnl and total_pnl > 0 else 0) if total_pnl and total_pnl > 0 else "$%.2f"|format(total_pnl if total_pnl else 0) }}</span>
            <p class="stat-subtitle">Cumulative profit</p>
        </div>
    </div>
    
    <!-- Signals Table -->
    <div class="signals-table-container">
        <div class="table-header">
            <div class="table-title">
                <span class="icon">📊</span>
                <h2>Signal Performance History</h2>
            </div>
            <div class="table-actions">
                <button class="filter-btn" onclick="toggleFilters()">
                    🔍 Filter
                </button>
                <a href="/export_journal" class="export-btn">
                    📥 Export CSV
                </a>
            </div>
        </div>
        
        <!-- Filters Panel -->
        <div class="filters-panel" id="filtersPanel">
            <div class="filters-grid">
                <div class="filter-group">
                    <label>Symbol</label>
                    <select class="filter-select" id="symbolFilter">
                        <option value="">All Symbols</option>
                        <option value="NASDAQ">NASDAQ</option>
                        <option value="DOW">DOW</option>
                        <option value="GOLD">GOLD</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Signal Type</label>
                    <select class="filter-select" id="typeFilter">
                        <option value="">All Types</option>
                        <option value="BUY">BUY</option>
                        <option value="SELL">SELL</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Outcome</label>
                    <select class="filter-select" id="outcomeFilter">
                        <option value="">All Outcomes</option>
                        <option value="WIN">Win</option>
                        <option value="LOSS">Loss</option>
                        <option value="BREAKEVEN">Breakeven</option>
                        <option value="PENDING">Pending</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Date From</label>
                    <input type="date" class="filter-input" id="dateFromFilter">
                </div>
            </div>
            <div class="filter-actions">
                <button class="action-btn" onclick="clearFilters()">Clear</button>
                <button class="action-btn primary" onclick="applyFilters()">Apply Filters</button>
            </div>
        </div>
        
        {% if signals and signals|length > 0 %}
        <div style="overflow-x: auto;">
            <table class="journal-table">
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Type</th>
                        <th>Entry Price</th>
                        <th>Take Profit</th>
                        <th>Stop Loss</th>
                        <th>Probability</th>
                        <th>Risk</th>
                        <th>Outcome</th>
                        <th>P&L</th>
                        <th>Timestamp</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for signal in signals %}
                    <tr data-signal-id="{{ signal.id if signal.id else loop.index }}">
                        <td class="symbol-cell">{{ signal[0] if signal[0] else signal.symbol }}</td>
                        <td>
                            <span class="signal-badge {{ 'buy' if ('BUY' in (signal[1] if signal[1] else signal.signal_type).upper()) else 'sell' }}">
                                {{ signal[1] if signal[1] else signal.signal_type }}
                            </span>
                        </td>
                        <td class="price-cell">{{ "${:,.2f}".format(signal[2] if signal[2] else signal.entry_price or 0) }}</td>
                        <td class="price-cell">{{ "${:,.2f}".format(signal[3] if signal[3] else signal.take_profit or 0) if (signal[3] if signal[3] else signal.take_profit) else '--' }}</td>
                        <td class="price-cell">{{ "${:,.2f}".format(signal[4] if signal[4] else signal.stop_loss or 0) if (signal[4] if signal[4] else signal.stop_loss) else '--' }}</td>
                        <td class="probability-cell">{{ "{:.1f}%".format((signal[5] if signal[5] else signal.predicted_probability or 0) * 100) }}</td>
                        <td>
                            <span class="risk-badge {{ (signal[6] if signal[6] else signal.risk_level or 'medium').lower() }}">
                                {{ signal[6] if signal[6] else signal.risk_level or 'MEDIUM' }}
                            </span>
                        </td>
                        <td>
                            {% set outcome = signal[7] if signal[7] else signal.actual_outcome %}
                            {% if outcome is not none %}
                                {% if outcome == 1 or outcome == 'WIN' %}
                                    <span class="outcome-badge win">✅ WIN</span>
                                {% elif outcome == 0 or outcome == 'LOSS' %}
                                    <span class="outcome-badge loss">❌ LOSS</span>
                                {% elif outcome == 2 or outcome == 'BREAKEVEN' %}
                                    <span class="outcome-badge breakeven">⚖️ BREAK</span>
                                {% else %}
                                    <span class="outcome-badge pending">⏳ PENDING</span>
                                {% endif %}
                            {% else %}
                                <span class="outcome-badge pending">⏳ PENDING</span>
                            {% endif %}
                        </td>
                        <td>
                            {% set pnl = signal[8] if signal[8] else signal.profit_loss %}
                            {% if pnl is not none %}
                                {% if pnl > 0 %}
                                    <span class="profit-cell positive">+${{ "{:.2f}".format(pnl) }}</span>
                                {% elif pnl < 0 %}
                                    <span class="profit-cell negative">${{ "{:.2f}".format(pnl) }}</span>
                                {% else %}
                                    <span class="profit-cell neutral">$0.00</span>
                                {% endif %}
                            {% else %}
                                <span class="profit-cell neutral">--</span>
                            {% endif %}
                        </td>
                        <td class="timestamp-cell">
                            <small>{{ signal[9] if signal[9] else signal.timestamp }}</small>
                        </td>
                        <td>
                            <button class="action-btn" onclick="viewSignalDetails('{{ signal.id if signal.id else loop.index }}')">
                                👁️ View
                            </button>
                            {% if not (signal[7] if signal[7] else signal.actual_outcome) %}
                            <button class="action-btn primary" onclick="updateOutcome('{{ signal.id if signal.id else loop.index }}')">
                                📝 Update
                            </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        <div class="pagination-container">
            <div class="pagination-info">
                Showing {{ signals|length }} of {{ total_signals if total_signals else signals|length }} signals
            </div>
            <div class="pagination-controls">
                <a href="#" class="pagination-btn disabled">← Previous</a>
                <a href="#" class="pagination-btn active">1</a>
                <a href="#" class="pagination-btn">2</a>
                <a href="#" class="pagination-btn">3</a>
                <a href="#" class="pagination-btn disabled">Next →</a>
            </div>
        </div>
        
        {% else %}
        <div class="empty-state">
            <span class="icon">📈</span>
            <h3>No Trading Signals Yet</h3>
            <p>Start generating signals with the Hybrid Math Strategy to build your trading journal.</p>
            <a href="/generate_signals" class="btn btn-primary">
                🎯 Generate First Signal
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Trading Journal JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize journal functionality
        initializeJournal();
    });

    function initializeJournal() {
        // Add hover effects to table rows
        document.querySelectorAll('.journal-table tbody tr').forEach(row => {
            row.addEventListener('mouseenter', function() {
                this.style.background = 'rgba(212, 175, 55, 0.05)';
            });
            
            row.addEventListener('mouseleave', function() {
                this.style.background = '';
            });
        });

        // Animate stat numbers on load
        animateStatNumbers();
    }

    function toggleFilters() {
        const filtersPanel = document.getElementById('filtersPanel');
        filtersPanel.classList.toggle('active');
    }

    function clearFilters() {
        document.querySelectorAll('.filter-select, .filter-input').forEach(input => {
            input.value = '';
        });
        applyFilters();
    }

    function applyFilters() {
        const symbolFilter = document.getElementById('symbolFilter').value;
        const typeFilter = document.getElementById('typeFilter').value;
        const outcomeFilter = document.getElementById('outcomeFilter').value;
        const dateFromFilter = document.getElementById('dateFromFilter').value;

        const rows = document.querySelectorAll('.journal-table tbody tr');
        let visibleCount = 0;

        rows.forEach(row => {
            const symbol = row.querySelector('.symbol-cell').textContent;
            const type = row.querySelector('.signal-badge').textContent.trim();
            const outcome = row.querySelector('.outcome-badge').textContent.trim();
            
            let show = true;

            if (symbolFilter && !symbol.includes(symbolFilter)) show = false;
            if (typeFilter && !type.includes(typeFilter)) show = false;
            if (outcomeFilter && !outcome.includes(outcomeFilter.split(' ')[0])) show = false;

            if (show) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });

        // Update pagination info
        const paginationInfo = document.querySelector('.pagination-info');
        if (paginationInfo) {
            paginationInfo.textContent = `Showing ${visibleCount} of ${rows.length} signals`;
        }

        showNotification(`Filtered to ${visibleCount} signals`, 'info');
    }

    function viewSignalDetails(signalId) {
        // Mock signal details - in real implementation, fetch from server
        const mockDetails = {
            symbol: 'NASDAQ',
            type: 'BUY',
            entryPrice: 23065.47,
            takeProfit: 23150.00,
            stopLoss: 23000.00,
            probability: 85.7,
            risk: 'MEDIUM',
            analysis: 'Strong bullish BOS detected with positive net change of +15.58. Market structure supports upward movement.',
            timestamp: new Date().toLocaleString()
        };

        // Create modal or navigate to details page
        showSignalModal(mockDetails);
    }

    function showSignalModal(details) {
        // Create modal overlay
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        `;

        modal.innerHTML = `
            <div style="
                background: var(--card-bg);
                border: 1px solid var(--golden-accent);
                border-radius: 12px;
                padding: 32px;
                max-width: 500px;
                width: 100%;
                backdrop-filter: blur(20px);
            ">
                <h3 style="color: var(--golden-primary); margin-bottom: 20px; font-size: 20px;">
                    📊 Signal Details
                </h3>
                <div style="display: grid; gap: 12px; margin-bottom: 24px;">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Symbol:</span>
                        <span style="color: var(--text-primary); font-weight: 600;">${details.symbol}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Type:</span>
                        <span style="color: var(--text-primary); font-weight: 600;">${details.type}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Entry Price:</span>
                        <span style="color: var(--text-primary); font-weight: 600;">$${details.entryPrice.toLocaleString()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Take Profit:</span>
                        <span style="color: var(--success-color); font-weight: 600;">$${details.takeProfit.toLocaleString()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Stop Loss:</span>
                        <span style="color: var(--danger-color); font-weight: 600;">$${details.stopLoss.toLocaleString()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: var(--text-secondary);">Probability:</span>
                        <span style="color: var(--golden-primary); font-weight: 600;">${details.probability}%</span>
                    </div>
                </div>
                <div style="margin-bottom: 24px;">
                    <h4 style="color: var(--text-primary); margin-bottom: 8px;">Analysis:</h4>
                    <p style="color: var(--text-secondary); line-height: 1.5; margin: 0;">${details.analysis}</p>
                </div>
                <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                        style="
                            width: 100%;
                            padding: 12px 24px;
                            background: var(--golden-primary);
                            color: var(--primary-bg);
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                    Close
                </button>
            </div>
        `;

        document.body.appendChild(modal);
    }

    function updateOutcome(signalId) {
        // Show outcome selection modal
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        `;

        modal.innerHTML = `
            <div style="
                background: var(--card-bg);
                border: 1px solid var(--golden-accent);
                border-radius: 12px;
                padding: 32px;
                max-width: 400px;
                width: 100%;
                backdrop-filter: blur(20px);
                text-align: center;
            ">
                <h3 style="color: var(--golden-primary); margin-bottom: 20px; font-size: 20px;">
                    📝 Update Signal Outcome
                </h3>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">
                    Select the outcome for this signal:
                </p>
                <div style="display: grid; gap: 12px; margin-bottom: 24px;">
                    <button onclick="submitOutcome('${signalId}', 'WIN')" 
                            style="
                                padding: 12px 24px;
                                background: rgba(0, 255, 136, 0.1);
                                color: var(--success-color);
                                border: 1px solid rgba(0, 255, 136, 0.2);
                                border-radius: 8px;
                                font-weight: 600;
                                cursor: pointer;
                            ">
                        ✅ WIN
                    </button>
                    <button onclick="submitOutcome('${signalId}', 'LOSS')" 
                            style="
                                padding: 12px 24px;
                                background: rgba(255, 71, 87, 0.1);
                                color: var(--danger-color);
                                border: 1px solid rgba(255, 71, 87, 0.2);
                                border-radius: 8px;
                                font-weight: 600;
                                cursor: pointer;
                            ">
                        ❌ LOSS
                    </button>
                    <button onclick="submitOutcome('${signalId}', 'BREAKEVEN')" 
                            style="
                                padding: 12px 24px;
                                background: rgba(255, 165, 2, 0.1);
                                color: var(--warning-color);
                                border: 1px solid rgba(255, 165, 2, 0.2);
                                border-radius: 8px;
                                font-weight: 600;
                                cursor: pointer;
                            ">
                        ⚖️ BREAKEVEN
                    </button>
                </div>
                <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                        style="
                            padding: 8px 16px;
                            background: transparent;
                            color: var(--text-secondary);
                            border: 1px solid var(--golden-accent);
                            border-radius: 6px;
                            cursor: pointer;
                        ">
                    Cancel
                </button>
            </div>
        `;

        document.body.appendChild(modal);
    }

    function submitOutcome(signalId, outcome) {
        // In real implementation, send to server
        fetch('/update_signal_outcome', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                signal_id: signalId,
                outcome: outcome
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification(`Signal outcome updated to ${outcome}`, 'success');
                // Refresh page or update row
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showNotification('Failed to update signal outcome', 'error');
            }
        })
        .catch(error => {
            showNotification('Error updating signal outcome', 'error');
        });

        // Close modal
        document.querySelector('[style*="position: fixed"]').remove();
    }

    function animateStatNumbers() {
        document.querySelectorAll('.big-number').forEach((element, index) => {
            const finalText = element.textContent;
            const finalValue = parseFloat(finalText.replace(/[^0-9.-]/g, ''));
            
            if (!isNaN(finalValue)) {
                element.textContent = '0';
                setTimeout(() => {
                    animateNumber(element, 0, finalValue, 1500, finalText);
                }, index * 200);
            }
        });
    }

    function animateNumber(element, start, end, duration, originalText) {
        const startTime = Date.now();
        const range = end - start;
        
        function update() {
            const now = Date.now();
            const elapsed = now - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const current = start + (range * easeOutCubic(progress));
            
            if (originalText.includes('%')) {
                element.textContent = current.toFixed(1) + '%';
            } else if (originalText.includes('$')) {
                if (current >= 0) {
                    element.textContent = '+$' + current.toFixed(2);
                } else {
                    element.textContent = '$' + current.toFixed(2);
                }
            } else {
                element.textContent = Math.round(current);
            }
            
            if (progress < 1) {
                requestAnimationFrame(update);
            } else {
                element.textContent = originalText;
            }
        }
        
        update();
    }

    function easeOutCubic(t) {
        return 1 - Math.pow(1 - t, 3);
    }
</script>
{% endblock %}